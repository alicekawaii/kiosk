================================================================================
                        販賣機金流系統分析文件 (SA)
                              System Analysis Document
                                    Version 2.0
================================================================================

文件資訊
--------
文件名稱：販賣機金流系統分析文件
文件版本：v2.0
建立日期：2025/11/06
最後更新：2025/11/06
文件狀態：正式版
專案名稱：販賣機金流整合系統 - 前端原型


================================================================================
1. 系統概述 (System Overview)
================================================================================

1.1 專案背景
------------
本系統為販賣機金流整合系統的前端原型介面，提供消費者在販賣機購物後進行線上付款的完整流程。
系統支援信用卡與 LINE Pay 兩種付款方式，並整合電子發票功能。

1.2 系統目標
------------
- 提供直覺易用的手機付款介面
- 支援多種付款方式（信用卡、LINE Pay）
- 整合電子發票功能（個人載具、公司統編）
- 符合金流安全標準（PCI-DSS）
- 提供流暢的使用者體驗

1.3 使用情境
------------
1. 消費者在販賣機選購商品
2. 販賣機產生訂單並顯示 QR Code
3. 消費者掃描 QR Code 開啟付款頁面
4. 選擇發票類型與付款方式
5. 完成付款授權
6. 系統顯示付款結果
7. 販賣機出貨
8. 消費者取貨並關閉頁面

1.4 技術規格
------------
- 類型：純前端靜態原型（Prototype）
- 開發語言：HTML5, CSS3, Vanilla JavaScript
- 設計模式：響應式網頁設計（RWD）
- 瀏覽器支援：Chrome 90+, Safari 14+, Firefox 88+, Edge 90+
- 螢幕支援：手機（375px+）、平板、桌面


================================================================================
2. 系統架構 (System Architecture)
================================================================================

2.1 頁面結構
------------

┌─────────────────────────────────────────────────────────────────┐
│                         販賣機金流系統                            │
└─────────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
                    ┌─────────────────────────┐
                    │   訂單確認頁              │
                    │   (index.html)           │
                    │   - 訂單資訊              │
                    │   - 發票選擇              │
                    │   - 付款方式              │
                    └─────────────────────────┘
                                  │
                    ┌─────────────┴─────────────┐
                    ▼                           ▼
        ┌───────────────────┐       ┌───────────────────┐
        │ 信用卡付款頁       │       │ LINE Pay 付款頁   │
        │ (credit-card.html)│       │ (linepay.html)    │
        │ - 卡片資訊輸入     │       │ - Request API     │
        │ - Luhn 驗證        │       │ - 付款確認        │
        │ - 付款授權         │       │ - Confirm API     │
        └───────────────────┘       └───────────────────┘
                    │                           │
                    └─────────────┬─────────────┘
                                  ▼
                    ┌─────────────────────────┐
                    │   付款完成頁              │
                    │   (complete.html)        │
                    │   - 成功：顯示交易資訊    │
                    │   - 失敗：提供重試選項    │
                    └─────────────────────────┘

2.2 檔案結構
------------
POC/
├── index.html                  # 訂單確認頁
├── credit-card.html            # 信用卡付款頁
├── linepay.html                # LINE Pay 付款頁
├── complete.html               # 付款完成頁
├── styles.css                  # 共用樣式表
├── script.js                   # 訂單頁邏輯
├── credit-card.js              # 信用卡頁邏輯
├── linepay.js                  # LINE Pay 頁邏輯
├── complete.js                 # 完成頁邏輯
├── modal.js                    # 自訂彈窗元件
├── credit card logo.png        # 信用卡圖示
├── LINE-Pay(h)_W119_n.png      # LINE Pay Logo
├── README.md                   # 說明文件
├── UPDATE_NOTES_2.md           # 更新記錄 v1.1
├── UPDATE_NOTES_3.md           # 更新記錄 v1.2 (Header)
├── UPDATE_NOTES_4.md           # 更新記錄 v1.3 (Complete Page)
├── 販賣機金流系統分析文件_SA.txt      # 原始 SA 文件
└── 販賣機金流系統分析文件_SA_v2.txt   # 本文件

2.3 資料流程
------------
1. 訂單資料透過 sessionStorage 在頁面間傳遞
2. 付款完成後清除 sessionStorage
3. URL 參數用於傳遞狀態（status, reason）


================================================================================
3. 功能需求 (Functional Requirements)
================================================================================

3.1 訂單確認頁 (P-01: index.html)
-----------------------------------

【FR-01-01】訂單資訊顯示
- 顯示販賣機編號（machineId）
- 顯示商品清單（名稱、數量、單價）
- 顯示訂單總金額
- 訂單資訊以卡片形式呈現

【FR-01-02】發票類型選擇
- 提供兩種發票類型：個人發票、公司發票
- 使用 Radio Button 切換
- 切換時顯示對應的輸入欄位

【FR-01-03】個人發票功能
- 載具類型選擇：
  * 手機條碼
  * 自然人憑證
  * 不索取發票
- 載具號碼輸入欄位（選擇載具時顯示）
- 捐贈碼輸入欄位（選填）
- 載具與捐贈碼互斥（擇一填寫）

【FR-01-04】公司發票功能
- 統一編號輸入（8 碼數字）
- 公司抬頭輸入

【FR-01-05】付款方式選擇
- 信用卡付款
- LINE Pay 付款
- 顯示對應的圖示
- 選中時顯示雙層黑框（白底）

【FR-01-06】表單驗證
- 即時驗證輸入格式
- 錯誤時顯示紅框 + 錯誤訊息
- 驗證失敗時阻止提交
- 自動捲動至第一個錯誤欄位

【FR-01-07】付款提交
- 驗證通過後儲存資料至 sessionStorage
- 根據付款方式導向對應頁面：
  * 信用卡 → credit-card.html
  * LINE Pay → linepay.html

---

3.2 信用卡付款頁 (P-02: credit-card.html)
------------------------------------------

【FR-02-01】Header 顯示
- 顯示「VENDING PAY」品牌 Logo
- 白色背景，黑色文字
- 固定在頂部（sticky）

【FR-02-02】訂單摘要顯示
- 販賣機編號
- 訂單編號（自動產生：TXN + timestamp）
- 付款金額

【FR-02-03】信用卡資訊輸入
- 卡號輸入：
  * 13-19 碼數字
  * 自動格式化（每 4 碼加空格）
  * Luhn 演算法驗證
  * 自動偵測卡別（Visa, MasterCard, AMEX, Discover, JCB）
- 持卡人姓名：
  * 英文字母
  * 自動轉大寫
  * 至少 2 個字元
- 有效期限：
  * MM/YY 格式
  * 自動格式化
  * 驗證月份（01-12）
  * 驗證是否過期
- 安全碼 CVV：
  * 3-4 碼數字
  * 僅數字輸入

【FR-02-04】安全提示
- 顯示信用卡圖示
- 說明 SSL 加密連線
- 說明 PCI-DSS 合規

【FR-02-05】操作按鈕
- 返回按鈕：返回訂單頁
- 確認付款按鈕：
  * 驗證所有欄位
  * 顯示處理中動畫（⏳ 處理中...）
  * 模擬 2 秒付款處理
  * 根據卡號決定結果：
    - 4111 1111 1111 1111 → 成功
    - 4000 0000 0000 0002 → 失敗
    - 其他有效卡號 → 成功

【FR-02-06】付款結果導向
- 成功：complete.html?status=success
- 失敗：complete.html?status=failure&reason=xxx

---

3.3 LINE Pay 付款頁 (P-03: linepay.html)
-----------------------------------------

【FR-03-01】無 Header
- LINE Pay 頁面不顯示 Header
- 直接顯示 LINE Pay Logo

【FR-03-02】載入狀態
- 顯示 LINE Pay Logo
- 顯示「正在連接 LINE Pay...」
- 顯示載入動畫
- 模擬 1.5 秒 Request API 呼叫

【FR-03-03】付款確認狀態
- 顯示 LINE Pay Logo
- 訂單資訊：
  * 訂單編號
  * 販賣機編號
  * 付款金額
- 商品明細：
  * 商品名稱
  * 數量
  * 單價
- 模擬提示：
  * 說明這是模擬頁面
  * 實際會轉跳至 LINE Pay 官方頁面

【FR-03-04】倒數計時
- 20 分鐘倒數計時器
- 格式：MM:SS
- 倒數結束自動取消付款

【FR-03-05】操作按鈕
- 確認付款按鈕：
  * 顯示 LINE Pay Logo
  * 顯示付款金額
  * 點擊後進入處理中狀態
- 取消付款按鈕：
  * 顯示確認對話框（Modal.confirm）
  * 確認後導向失敗頁
  * 取消則繼續付款流程

【FR-03-06】處理中狀態
- 顯示「付款處理中...」
- 顯示載入動畫
- 模擬 2 秒 Confirm API 呼叫
- 模擬 95% 成功率

【FR-03-07】付款結果導向
- 成功：complete.html?status=success
- 失敗：complete.html?status=failure&reason=xxx

---

3.4 付款完成頁 (P-04: complete.html)
-------------------------------------

【FR-04-01】Header 顯示
- 顯示「VENDING PAY」品牌 Logo
- 白色背景，黑色文字
- 固定在頂部（sticky）

【FR-04-02】成功狀態顯示
- 綠色勾勾圖示 ✓
- 標題：付款成功
- 交易資訊卡片：
  * 交易編號
  * 付款金額
  * 付款方式
  * 電子發票號碼（模擬產生：2 碼英文 + 8 碼數字）
- 完成訊息：
  * 綠色文字（#06c755）
  * 「✓ 交易完成，請從販賣機取貨後關閉此頁面」
  * 粗體、16px
- 不自動跳轉、不倒數、不彈窗
- 保留頁面讓用戶查看資訊、截圖

【FR-04-03】失敗狀態顯示
- 紅色叉叉圖示 ✗
- 標題：付款失敗
- 失敗資訊：
  * 失敗原因
  * 交易編號
- 操作按鈕：
  * 重新付款：返回 index.html
  * 取消訂單：顯示確認對話框（Modal.confirm），確認後返回 index.html

【FR-04-04】資料處理
- 付款成功後立即清除 sessionStorage
- 失敗時保留資料供重試使用

---

3.5 自訂彈窗元件 (modal.js)
----------------------------

【FR-05-01】Modal.alert
- 取代系統 alert()
- 單一確定按鈕
- 黑白配色
- 淡入淡出動畫

【FR-05-02】Modal.confirm
- 取代系統 confirm()
- 取消 + 確定按鈕
- 提供 callback 函數
- 取消可選填 cancelCallback

【FR-05-03】樣式設計
- 遮罩層：半透明黑色
- 對話框：白色背景、黑色邊框
- 按鈕：主要按鈕黑色、次要按鈕灰框
- 動畫：0.3 秒淡入


================================================================================
4. 業務規則 (Business Rules)
================================================================================

【BR-01】統一編號驗證
- 必須為 8 碼純數字
- 首碼不可為 0
- 正規表示式：^[1-9][0-9]{7}$

【BR-02】手機條碼驗證
- 必須以 / 開頭
- 後接 7 碼英數字（大寫）
- 正規表示式：^/[A-Z0-9]{7}$

【BR-03】捐贈碼驗證
- 必須為 3-7 碼純數字
- 正規表示式：^[0-9]{3,7}$

【BR-04】載具與捐贈碼互斥
- 選擇載具時，不可填寫捐贈碼
- 填寫捐贈碼時，不可選擇載具
- 兩者擇一或皆不填

【BR-05】信用卡號驗證
- 使用 Luhn 演算法驗證
- 支援 13-19 碼卡號
- 支援主流卡別：Visa, MasterCard, AMEX, Discover, JCB

【BR-06】有效期限驗證
- 月份必須在 01-12 之間
- 不可為過期日期
- 與當前年月比較

【BR-07】測試卡號規則
- 4111 1111 1111 1111 → 付款成功
- 4000 0000 0000 0002 → 付款失敗（授權被拒）
- 其他通過 Luhn 驗證的卡號 → 付款成功

【BR-08】LINE Pay 倒數計時
- 20 分鐘（1200 秒）倒數
- 時間到自動取消付款
- 取消付款需用戶確認

【BR-09】付款完成頁規則
- 成功：不倒數、不跳轉、不彈窗
- 失敗：提供重試和取消選項
- 取消訂單需二次確認


================================================================================
5. 介面規範 (UI Specifications)
================================================================================

5.1 設計語言
------------
- 色系：黑白為主
- 字體：系統預設字體（-apple-system, BlinkMacSystemFont, "Segoe UI"）
- 圓角：4-8px
- 間距：基準 10px（10, 15, 20, 25, 30px）

5.2 色彩規範
------------
【主色調】
- 黑色：#000, #333
- 白色：#fff
- 灰色：#666, #999, #ccc, #ddd, #e5e5e5, #f5f5f5, #fafafa

【狀態色】
- 成功：#06c755 (LINE Pay 綠), #4caf50 (Material 綠)
- 錯誤：#d00, #f44336
- 警告：#ff9800
- 資訊：#2196f3

5.3 排版規範
------------
【標題】
- H1 (page-title): 24px, 粗體, #333
- H2 (section-title): 18px, 粗體, #333

【內文】
- 正文：14px, #666
- 標籤：12px, #999
- 數值：14px, #333, 粗體

【按鈕】
- 主要按鈕：黑底白字，高 48px
- 次要按鈕：白底黑字黑框，高 48px

5.4 Header 規範
---------------
- 背景色：#fff
- 文字色：#000
- Logo 文字：「VENDING PAY」
- 字體大小：20px (桌面), 18px (手機), 16px (小螢幕)
- 位置：sticky, top: 0
- 邊框：底部 2px, #e5e5e5
- 陰影：0 2px 4px rgba(0, 0, 0, 0.05)
- 例外：LINE Pay 頁面不顯示 Header

5.5 表單規範
------------
【輸入框】
- 高度：48px
- 邊框：1px solid #ddd
- 圓角：4px
- 內距：12px
- 錯誤狀態：紅框 (#d00)

【選擇框】
- Radio/Checkbox：18px 圓形
- 選中顏色：#000

【錯誤訊息】
- 顏色：#d00
- 字體：12px
- 位置：輸入框下方 5px

5.6 卡片規範
------------
- 背景：#fff
- 邊框：1px solid #e5e5e5
- 圓角：8px
- 內距：20px
- 陰影：可選（0 2px 4px rgba(0,0,0,0.1)）

5.7 按鈕規範
------------
【主要按鈕】
- 背景：#000
- 文字：#fff
- 高度：48px
- 圓角：4px
- Hover：#333

【次要按鈕】
- 背景：#fff
- 文字：#000
- 邊框：2px solid #000
- Hover：背景 #f5f5f5

【固定底部按鈕】
- 位置：fixed, bottom: 0
- 背景：#fff
- 陰影：0 -2px 10px rgba(0,0,0,0.1)
- 內距：15px 20px
- 支援雙按鈕排列

5.8 圖示規範
------------
- 信用卡圖示：credit card logo.png
- LINE Pay Logo：LINE-Pay(h)_W119_n.png
- 圖示尺寸：
  * 付款方式選擇：48px 高度
  * 安全提示：32px 高度
  * LINE Pay 標題：50px 高度
  * LINE Pay 按鈕：20px 高度

5.9 Modal 彈窗規範
------------------
- 遮罩：rgba(0, 0, 0, 0.5)
- 對話框背景：#fff
- 對話框圓角：8px
- 對話框最大寬度：400px
- 邊框：2px solid #000
- 動畫：淡入淡出 0.3s


================================================================================
6. 響應式設計 (Responsive Design)
================================================================================

6.1 斷點定義
------------
- 小螢幕手機：< 375px
- 手機：375px - 767px
- 平板：768px - 1023px
- 桌面：≥ 1024px

6.2 容器規範
------------
【手機 (< 768px)】
- 寬度：100%
- 內距：15px
- 背景：#fff
- 無陰影

【平板 & 桌面 (≥ 768px)】
- 最大寬度：600px
- 置中對齊：margin: 0 auto
- 內距：20px
- 背景：#fff
- 陰影：0 2px 10px rgba(0,0,0,0.1)

6.3 字體調整
------------
| 元素          | 手機    | 平板/桌面 |
|--------------|---------|----------|
| Header Logo  | 18px    | 20px     |
| Page Title   | 22px    | 24px     |
| Section Title| 16px    | 18px     |
| Body Text    | 14px    | 14px     |
| Button Text  | 16px    | 16px     |

6.4 按鈕調整
------------
【手機】
- 寬度：100%
- 堆疊排列（垂直）

【平板/桌面】
- 寬度：auto 或 100%（視情境）
- 水平排列（Flex）

6.5 特殊處理
------------
- Body padding-bottom：140px（容納固定底部按鈕）
- 小螢幕 (≤ 375px)：Header Logo 16px


================================================================================
7. 非功能需求 (Non-Functional Requirements)
================================================================================

【NFR-01】效能需求
- 頁面載入時間：< 2 秒
- 表單驗證回應：即時（< 100ms）
- 頁面切換：平滑無閃爍

【NFR-02】相容性需求
- Chrome 90+
- Safari 14+
- Firefox 88+
- Edge 90+
- Samsung Internet 14+
- iOS Safari 14+
- Android Chrome 90+

【NFR-03】可用性需求
- 支援觸控操作
- 按鈕點擊區域：≥ 44x44px
- 錯誤訊息清晰易懂
- 自動捲動至錯誤欄位

【NFR-04】安全需求（提示性）
- 顯示 SSL 加密提示
- 顯示 PCI-DSS 合規提示
- CVV 欄位使用 password 類型
- 付款完成後清除敏感資料

【NFR-05】維護性需求
- 程式碼模組化
- 函數命名清晰
- 適當註解
- 統一程式碼風格

【NFR-06】擴展性需求
- 預留後端 API 整合介面
- 預留 WebSocket 通訊註解
- 模組化設計便於擴展


================================================================================
8. 資料模型 (Data Model)
================================================================================

8.1 訂單資料結構 (PaymentData)
-------------------------------
儲存於 sessionStorage，key: 'paymentData'

{
  // 訂單資訊
  "machineId": "VM-TPE-001",          // 販賣機編號
  "orderId": "TXN20251106001",        // 訂單編號
  "totalAmount": 60,                  // 總金額
  "products": [                       // 商品清單
    {
      "name": "可口可樂",
      "quantity": 1,
      "price": 25
    },
    {
      "name": "洋芋片",
      "quantity": 1,
      "price": 35
    }
  ],

  // 發票資訊
  "invoiceType": "personal",          // 發票類型：personal | company
  "carrierType": "mobile",            // 載具類型：mobile | natural | none
  "carrierNumber": "/ABC1234",        // 載具號碼
  "donationCode": "",                 // 捐贈碼
  "taxId": "",                        // 統一編號
  "companyName": "",                  // 公司抬頭

  // 付款資訊
  "paymentMethod": "credit"           // 付款方式：credit | linepay
}

8.2 URL 參數規範
----------------
【complete.html 參數】
- status: success | failure          // 付款狀態
- reason: string                     // 失敗原因（選填）

範例：
- 成功：complete.html?status=success
- 失敗：complete.html?status=failure&reason=信用卡授權失敗


================================================================================
9. 流程圖 (Flow Charts)
================================================================================

9.1 整體付款流程
----------------

[開始]
  ↓
[掃描 QR Code / 開啟 index.html]
  ↓
[查看訂單資訊]
  ↓
[選擇發票類型]
  ├─ 個人發票 → [選擇載具 或 捐贈碼]
  └─ 公司發票 → [填寫統編 + 抬頭]
  ↓
[選擇付款方式]
  ├─ 信用卡
  └─ LINE Pay
  ↓
[點擊「確認付款」]
  ↓
[表單驗證]
  ├─ 驗證失敗 → [顯示錯誤訊息] → [修正輸入]
  └─ 驗證通過 → [儲存至 sessionStorage]
  ↓
[導向付款頁]
  ├─ 信用卡 → [credit-card.html]
  └─ LINE Pay → [linepay.html]
  ↓
[完成付款授權]
  ↓
[導向 complete.html]
  ├─ 成功 → [顯示交易資訊] → [用戶查看 → 取貨 → 關閉頁面]
  └─ 失敗 → [顯示失敗原因] → [重新付款 或 取消訂單]
  ↓
[結束]

---

9.2 信用卡付款流程
------------------

[進入 credit-card.html]
  ↓
[顯示訂單摘要]
  ↓
[輸入信用卡資訊]
  ├─ 卡號 → [自動格式化] → [Luhn 驗證] → [偵測卡別]
  ├─ 持卡人 → [自動大寫]
  ├─ 有效期限 → [格式化 MM/YY] → [驗證月份] → [檢查過期]
  └─ CVV → [僅數字輸入]
  ↓
[點擊「確認付款」]
  ↓
[驗證所有欄位]
  ├─ 有錯誤 → [標示錯誤欄位] → [捲動至錯誤位置] → [修正輸入]
  └─ 全部正確
  ↓
[禁用按鈕] + [顯示「處理中...」]
  ↓
[模擬付款處理 2 秒]
  ↓
[檢查卡號]
  ├─ 4111 1111 1111 1111 → [付款成功]
  ├─ 4000 0000 0000 0002 → [付款失敗]
  └─ 其他有效卡號 → [付款成功]
  ↓
[導向 complete.html]
  ├─ 成功：?status=success
  └─ 失敗：?status=failure&reason=xxx

---

9.3 LINE Pay 付款流程
---------------------

[進入 linepay.html]
  ↓
[載入狀態]
  ├─ 顯示 Logo
  ├─ 顯示「正在連接 LINE Pay...」
  └─ 顯示載入動畫
  ↓
[模擬 Request API 1.5 秒]
  ↓
[付款確認狀態]
  ├─ 顯示訂單資訊
  ├─ 顯示商品明細
  ├─ 顯示模擬提示
  ├─ 開始 20 分鐘倒數
  └─ 顯示「確認付款」和「取消付款」按鈕
  ↓
[用戶操作]
  ├─ 點擊「取消付款」
  │   ↓
  │   [顯示確認對話框]
  │   ├─ 點擊「取消」→ [繼續付款流程]
  │   └─ 點擊「確定」→ [導向失敗頁]
  │
  └─ 點擊「確認付款」
      ↓
      [處理中狀態]
      ├─ 顯示「付款處理中...」
      └─ 顯示載入動畫
      ↓
      [模擬 Confirm API 2 秒]
      ↓
      [模擬 95% 成功率]
      ├─ 95% → [付款成功]
      └─ 5% → [付款失敗]
      ↓
      [導向 complete.html]
      ├─ 成功：?status=success
      └─ 失敗：?status=failure&reason=xxx

---

9.4 付款完成頁流程
------------------

[進入 complete.html]
  ↓
[讀取 URL 參數]
  ├─ status = success → [成功流程]
  ├─ status = failure → [失敗流程]
  └─ 無參數 → [導向 index.html]

【成功流程】
  ↓
[讀取 sessionStorage 資料]
  ↓
[顯示交易資訊]
  ├─ 交易編號
  ├─ 付款金額
  ├─ 付款方式
  └─ 電子發票號碼（模擬產生）
  ↓
[清除 sessionStorage]
  ↓
[顯示完成訊息]
  └─ 「✓ 交易完成，請從販賣機取貨後關閉此頁面」
  ↓
[用戶查看資訊 / 截圖]
  ↓
[取貨]
  ↓
[手動關閉頁面]
  ↓
[結束]

【失敗流程】
  ↓
[顯示失敗原因]
  ↓
[顯示交易編號]
  ↓
[顯示操作按鈕]
  ├─ 重新付款 → [導向 index.html]
  └─ 取消訂單
      ↓
      [顯示確認對話框]
      ├─ 點擊「取消」→ [留在頁面]
      └─ 點擊「確定」
          ↓
          [清除 sessionStorage]
          ↓
          [導向 index.html]


================================================================================
10. 測試規範 (Test Specifications)
================================================================================

10.1 測試資料
-------------

【發票資訊測試資料】
- 統一編號（有效）: 12345678
- 統一編號（無效 - 7碼）: 1234567
- 統一編號（無效 - 首碼0）: 01234567
- 手機條碼（有效）: /ABC1234
- 手機條碼（無效 - 缺/）: ABC1234
- 捐贈碼（有效）: 9999
- 捐贈碼（無效 - 少於3碼）: 99

【信用卡測試資料】
- 測試卡號（成功）: 4111 1111 1111 1111
- 測試卡號（失敗）: 4000 0000 0000 0002
- 測試卡號（MasterCard）: 5500 0000 0000 0004
- 測試卡號（無效 - Luhn失敗）: 1234 5678 9012 3456
- 持卡人姓名: WANG DA MING
- 有效期限（有效）: 12/28
- 有效期限（無效 - 月份錯誤）: 13/25
- 有效期限（無效 - 已過期）: 01/20
- CVV: 123

10.2 測試案例
-------------

【TC-01】訂單頁 - 個人發票 + 手機條碼 + 信用卡
前置條件：開啟 index.html
步驟：
  1. 選擇「個人發票」
  2. 選擇載具類型「手機條碼」
  3. 輸入手機條碼：/ABC1234
  4. 選擇付款方式「信用卡」
  5. 點擊「確認付款」
預期結果：
  - 導向 credit-card.html
  - sessionStorage 儲存正確資料

【TC-02】訂單頁 - 公司發票驗證
前置條件：開啟 index.html
步驟：
  1. 選擇「公司發票」
  2. 輸入統一編號：1234567（7碼）
  3. 輸入公司抬頭：測試公司
  4. 點擊「確認付款」
預期結果：
  - 顯示錯誤訊息：「統一編號必須為 8 碼數字」
  - 統編欄位顯示紅框
  - 阻止提交

【TC-03】信用卡頁 - 成功付款
前置條件：從 index.html 導向 credit-card.html
步驟：
  1. 輸入卡號：4111 1111 1111 1111
  2. 輸入持卡人：WANG DA MING
  3. 輸入有效期限：12/28
  4. 輸入 CVV：123
  5. 點擊「確認付款」
預期結果：
  - 顯示「處理中...」2 秒
  - 導向 complete.html?status=success
  - 顯示交易成功資訊

【TC-04】信用卡頁 - 失敗付款
前置條件：從 index.html 導向 credit-card.html
步驟：
  1. 輸入卡號：4000 0000 0000 0002
  2. 輸入持卡人：WANG DA MING
  3. 輸入有效期限：12/28
  4. 輸入 CVV：123
  5. 點擊「確認付款」
預期結果：
  - 顯示「處理中...」2 秒
  - 導向 complete.html?status=failure
  - 顯示失敗原因

【TC-05】信用卡頁 - Luhn 驗證
前置條件：開啟 credit-card.html
步驟：
  1. 輸入卡號：1234 5678 9012 3456
  2. 點擊其他欄位（觸發 blur）
預期結果：
  - 顯示錯誤訊息：「卡號格式錯誤，請重新確認」
  - 卡號欄位顯示紅框

【TC-06】LINE Pay - 成功流程
前置條件：從 index.html 選擇 LINE Pay
步驟：
  1. 等待載入狀態 1.5 秒
  2. 查看訂單資訊和商品明細
  3. 點擊「確認付款」
  4. 等待處理中 2 秒
預期結果：
  - 導向 complete.html（95% 機率成功）
  - 顯示交易資訊

【TC-07】LINE Pay - 取消付款
前置條件：在 linepay.html 付款確認狀態
步驟：
  1. 點擊「取消付款」
  2. 在確認對話框點擊「確定」
預期結果：
  - 導向 complete.html?status=failure&reason=使用者取消付款
  - 顯示取消訊息

【TC-08】完成頁 - 取消訂單
前置條件：complete.html?status=failure
步驟：
  1. 點擊「取消訂單」
  2. 在確認對話框點擊「確定」
預期結果：
  - 清除 sessionStorage
  - 導向 index.html

【TC-09】響應式測試 - 手機版
前置條件：瀏覽器寬度 375px
步驟：
  1. 開啟 index.html
  2. 檢查排版
預期結果：
  - 按鈕全寬
  - 文字大小適中
  - 無水平捲軸

【TC-10】響應式測試 - 桌面版
前置條件：瀏覽器寬度 1024px
步驟：
  1. 開啟 index.html
  2. 檢查排版
預期結果：
  - 容器最大寬度 600px
  - 置中對齊
  - 有陰影效果

10.3 瀏覽器相容性測試
---------------------
需在以下瀏覽器測試所有功能：
- Chrome 90+（Windows, macOS, Android）
- Safari 14+（macOS, iOS）
- Firefox 88+（Windows, macOS）
- Edge 90+（Windows）
- Samsung Internet 14+（Android）


================================================================================
11. 部署與維護 (Deployment & Maintenance)
================================================================================

11.1 部署需求
-------------
【檔案部署】
- 將所有 HTML, CSS, JS, PNG 檔案上傳至 Web Server
- 確保檔案路徑正確（相對路徑）
- 圖片檔案需與 HTML 在同一目錄

【伺服器設定】
- 支援 HTTPS（建議）
- MIME Type 設定正確：
  * .html → text/html
  * .css → text/css
  * .js → application/javascript
  * .png → image/png

【無需後端】
- 純靜態檔案
- 無資料庫需求
- 無伺服器端程式

11.2 監控項目
-------------
- 頁面載入時間
- JavaScript 錯誤監控
- 使用者行為追蹤（可選）

11.3 維護計畫
-------------
【定期檢查】
- 瀏覽器相容性（每季）
- 連結有效性（每月）
- 圖片顯示正常（每月）

【更新記錄】
- 維護 UPDATE_NOTES_*.md
- 記錄版本變更
- 記錄 Bug 修復

11.4 備份策略
-------------
- 定期備份所有檔案
- 版本控制（建議使用 Git）
- 保留歷史版本


================================================================================
12. 未來擴展規劃 (Future Enhancements)
================================================================================

12.1 短期規劃（1-3 個月）
--------------------------
【FE-01】後端整合
- 串接真實金流 API（綠界、藍新）
- 串接電子發票 API
- 串接販賣機後端系統

【FE-02】安全強化
- 實作真實的 SSL 加密
- 加入 CSRF Token
- 加入請求簽章驗證

【FE-03】使用者體驗優化
- 加入載入動畫
- 加入頁面轉場效果
- 優化錯誤訊息文案

12.2 中期規劃（3-6 個月）
--------------------------
【FE-04】多語系支援
- 繁體中文
- 英文
- 日文

【FE-05】更多付款方式
- Apple Pay
- Google Pay
- 街口支付
- 悠遊付

【FE-06】會員系統
- 會員登入
- 儲存常用付款方式
- 消費記錄查詢

12.3 長期規劃（6-12 個月）
---------------------------
【FE-07】進階功能
- WebSocket 即時通訊
- 推播通知（出貨完成）
- QR Code 動態產生
- 訂單追蹤系統

【FE-08】數據分析
- 使用者行為分析
- 轉換率追蹤
- A/B Testing 平台

【FE-09】管理後台
- 交易記錄管理
- 販賣機狀態監控
- 報表產生


================================================================================
13. 附錄 (Appendix)
================================================================================

13.1 技術文件連結
-----------------
- Luhn Algorithm: https://en.wikipedia.org/wiki/Luhn_algorithm
- LINE Pay API: https://pay.line.me/tw/developers/apis/onlineApis
- PCI-DSS: https://www.pcisecuritystandards.org/

13.2 設計參考
-------------
- Material Design Guidelines
- Apple Human Interface Guidelines
- LINE Design System

13.3 正規表示式參考
-------------------
- 統一編號：^[1-9][0-9]{7}$
- 手機條碼：^/[A-Z0-9]{7}$
- 捐贈碼：^[0-9]{3,7}$
- 信用卡號：^\d{13,19}$
- 有效期限：^\d{2}/\d{2}$
- CVV：^\d{3,4}$

13.4 CSS 動畫關鍵影格
---------------------
【載入動畫】
@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

【淡入】
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

【淡出】
@keyframes fadeOut {
  from { opacity: 1; }
  to { opacity: 0; }
}

13.5 常見問題 (FAQ)
-------------------

Q1: 為什麼 LINE Pay 頁面沒有 Header？
A1: 為了模擬真實的 LINE Pay 官方頁面體驗，該頁面不顯示系統 Header，僅顯示 LINE Pay 自己的 Logo。

Q2: 付款成功後為什麼不自動關閉頁面？
A2: 考量販賣機使用情境，用戶需要時間查看交易資訊、截圖記錄、等待取貨。自動關閉會造成不便。

Q3: 為什麼信用卡失敗率只有特定卡號？
A3: 為了測試方便，我們設定特定卡號（4000 0000 0000 0002）觸發失敗流程，其餘有效卡號都會成功。

Q4: 為什麼不使用系統 alert/confirm？
A4: 自訂 Modal 可以保持介面風格一致，提供更好的使用者體驗和品牌識別。

Q5: sessionStorage 會保留多久？
A5: sessionStorage 在分頁關閉時會自動清除。付款成功後系統也會主動清除。

13.6 版本歷史
-------------
- v1.0 (2025/11/06): 初版開發完成
  * 訂單確認頁
  * 信用卡付款頁
  * LINE Pay 付款頁
  * 付款完成頁

- v1.1 (2025/11/06): UI/UX 優化
  * 自訂 Modal 元件
  * 修正 LINE Pay 置中問題
  * 修改付款方式選擇樣式
  * 修正信用卡頁底部留白

- v1.2 (2025/11/06): Header 新增
  * 所有頁面新增 Header
  * 顯示「VENDING PAY」Logo
  * LINE Pay 頁面移除 Header

- v1.3 (2025/11/06): 完成頁流程優化
  * 移除成功頁倒數計時
  * 直接顯示完成訊息
  * 移除自動跳轉和彈窗
  * 優化販賣機使用情境

- v2.0 (2025/11/06): 文件更新
  * 根據實際實作更新 SA 文件
  * 新增測試卡號規則
  * 完善流程圖和測試案例

13.7 貢獻者
-----------
- 系統分析：Claude Code
- 前端開發：Claude Code
- UI/UX 設計：Claude Code
- 文件撰寫：Claude Code

13.8 授權資訊
-------------
本專案僅供內部開發測試使用。
所有圖片素材（LINE Pay Logo, 信用卡圖示）版權屬於各自所有者。


================================================================================
文件結束
================================================================================

本文件為「販賣機金流系統」之完整系統分析文件，涵蓋功能需求、介面規範、
業務規則、測試案例等內容。

如有任何疑問或需要補充，請聯繫專案負責人。

文件版本：v2.0
最後更新：2025/11/06
