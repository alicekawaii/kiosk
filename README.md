# 販賣機金流系統 - 前端原型

## 專案說明

這是一個販賣機金流整合系統的手機版前端原型介面，基於「販賣機金流系統分析文件_SA_v2.txt」開發。

**重要文件：**
- `販賣機金流系統分析文件_SA_v2.txt` - 完整的系統分析文件（必讀）
- `UPDATE_NOTES_2.md` - v1.1 更新記錄（Modal 元件、UI 優化）
- `UPDATE_NOTES_3.md` - v1.2 更新記錄（Header 新增）
- `UPDATE_NOTES_4.md` - v1.3 更新記錄（付款完成頁流程優化）
- `README.md` - 本文件（快速上手指南）

## 功能特色

### 1. 訂單確認頁面 (index.html)
- **訂單資訊顯示**
  - 商品清單（名稱、數量、單價）
  - 總金額顯示
  - 販賣機編號

- **發票資訊**
  - 個人發票
    - 載具類型選擇（手機條碼、自然人憑證、不索取）
    - 載具號碼輸入
    - 捐贈碼輸入（選填）
  - 公司發票
    - 統一編號（8碼驗證）
    - 公司抬頭

- **付款方式**
  - 信用卡
  - LINE Pay

### 2. 信用卡付款頁面 (credit-card.html)
- **訂單摘要**
  - 販賣機編號
  - 訂單編號
  - 付款金額

- **信用卡資訊輸入**
  - 卡號（自動格式化、Luhn 演算法驗證）
  - 持卡人姓名（自動大寫）
  - 有效期限（MM/YY 格式）
  - 安全碼 CVV（3-4碼）
  - 自動偵測卡片類型（Visa、MasterCard 等）

- **安全提示**
  - SSL 加密連線說明
  - PCI-DSS 合規提示

### 3. LINE Pay 付款頁面 (linepay.html)
- **載入狀態**
  - 模擬 Request API 呼叫

- **付款確認頁面**
  - 訂單資訊顯示
  - 商品明細列表
  - 確認付款按鈕
  - 取消付款按鈕
  - 20分鐘倒數計時器

- **處理中狀態**
  - 模擬 Confirm API 呼叫

### 4. 付款完成頁面 (complete.html)
- **成功狀態**
  - 交易編號
  - 付款金額
  - 付款方式
  - 電子發票號碼（自動產生）
  - **直接顯示完成訊息**（不倒數、不跳轉、不彈窗）
  - 讓用戶查看交易資訊、截圖、取貨後自行關閉

- **失敗狀態**
  - 失敗原因說明
  - 重新付款按鈕（返回 index.html）
  - 取消訂單按鈕（確認後返回 index.html）

## 技術規格

### 響應式設計 (RWD)
- **手機** (< 768px): 單欄式佈局，按鈕全寬
- **平板** (768-1024px): 單欄式，最大寬度600px置中
- **桌機** (> 1024px): 同平板規格，加入陰影效果

### 表單驗證規則
根據文件 BR-01、BR-02、BR-03 規範：

- **統一編號**
  - 格式: 8碼純數字
  - 正規表示式: `^[0-9]{8}$`
  - 首碼不可為0

- **手機條碼**
  - 格式: /開頭 + 7碼英數字
  - 正規表示式: `^/[A-Z0-9]{7}$`

- **捐贈碼**
  - 格式: 3-7碼數字
  - 正規表示式: `^[0-9]{3,7}$`

### 色彩設計
採用黑白色系，提供清晰的視覺層次：
- **主色**: 黑色 (#000, #333)
- **背景**: 白色 (#fff) - 全局統一白色背景
- **邊框**: 灰色系 (#ccc, #ddd, #e5e5e5)
- **成功**: 綠色 (#06c755 LINE Pay 綠, #4caf50)
- **錯誤**: 紅色 (#d00, #f44336)

### Header 設計
- **背景色**: 白色 (#fff)
- **文字色**: 黑色 (#000)
- **Logo**: 「VENDING PAY」
- **位置**: Sticky 固定在頂部
- **例外**: LINE Pay 頁面不顯示 Header

### Modal 彈窗元件
使用自訂 Modal 取代系統 alert/confirm：
- `Modal.alert(message, callback)` - 單一確定按鈕
- `Modal.confirm(message, confirmCallback, cancelCallback)` - 確認對話框
- 黑白配色，平滑動畫效果

## 檔案結構

```
POC/
├── index.html                          # 訂單確認頁
├── credit-card.html                    # 信用卡付款頁
├── linepay.html                        # LINE Pay 付款頁
├── complete.html                       # 付款完成頁
├── styles.css                          # 共用樣式表
├── script.js                           # 訂單頁邏輯
├── credit-card.js                      # 信用卡頁邏輯
├── linepay.js                          # LINE Pay 頁邏輯
├── complete.js                         # 完成頁邏輯
├── modal.js                            # 自訂 Modal 彈窗元件
├── credit card logo.png                # 信用卡圖示
├── LINE-Pay(h)_W119_n.png             # LINE Pay Logo
├── README.md                           # 本說明文件（快速上手）
├── 販賣機金流系統分析文件_SA.txt          # 原始 SA 文件
├── 販賣機金流系統分析文件_SA_v2.txt      # 完整 SA 文件 v2.0（必讀）
├── UPDATE_NOTES_2.md                   # v1.1 更新記錄
├── UPDATE_NOTES_3.md                   # v1.2 更新記錄
└── UPDATE_NOTES_4.md                   # v1.3 更新記錄
```

## 使用方法

### 1. 開啟訂單頁面
直接用瀏覽器開啟 `index.html`

### 2. 操作流程

**完整付款流程：**

1. **訂單確認頁** (`index.html`)
   - 查看訂單資訊（商品、金額）
   - 選擇發票類型
     - 個人：選擇載具或捐贈
     - 公司：填寫統編和抬頭
   - 選擇付款方式（信用卡 / LINE Pay）
   - 點擊「確認付款」

2. **信用卡付款** (`credit-card.html`) 或 **LINE Pay** (`linepay.html`)
   - **如選擇信用卡**：
     - 輸入卡號、持卡人姓名、有效期限、CVV
     - 系統自動驗證卡號格式
     - 點擊「確認付款」

   - **如選擇 LINE Pay**：
     - 系統模擬 Request API 呼叫
     - 顯示訂單資訊和商品明細
     - 20分鐘倒數計時
     - 點擊「確認付款」進行授權

3. **付款完成頁** (`complete.html`)
   - **成功**：顯示交易資訊、發票號碼、完成訊息（不倒數、不跳轉）
   - **失敗**：顯示失敗原因、提供重新付款或取消選項

### 3. 測試資料

**發票資訊測試資料:**
- 統一編號: `12345678`
- 手機條碼: `/ABC1234`
- 捐贈碼: `9999`

**信用卡測試資料:**
- 測試卡號（成功）: `4111 1111 1111 1111` → 付款成功
- 測試卡號（失敗）: `4000 0000 0000 0002` → 付款失敗（授權被拒）
- 持卡人姓名: `WANG DA MING` (任意英文)
- 有效期限: `12/28` (任何未來日期)
- CVV: `123` (任意 3 碼數字)

**無效的測試資料:**
- 統一編號: `1234567` (7碼，應為8碼)
- 統一編號: `01234567` (首碼為0)
- 手機條碼: `ABC1234` (缺少/)
- 捐贈碼: `99` (少於3碼)
- 卡號: `1234 5678 9012 3456` (Luhn 驗證失敗)
- 有效期限: `13/25` (月份錯誤)
- 有效期限: `01/20` (已過期)

## 符合文件規範

### 頁面結構 (P-01)
✓ 訂單資訊區塊
✓ 發票資訊區塊
✓ 付款方式區塊
✓ 操作區塊（底部固定按鈕）

### 業務規則
✓ BR-01: 統編必須8碼數字
✓ BR-02: 手機條碼格式 /[A-Z0-9]{7}
✓ BR-03: 捐贈碼3-7碼數字

### 頁面邏輯
✓ 發票類型切換顯示對應欄位
✓ 載具與捐贈碼互斥
✓ 表單驗證與錯誤提示
✓ 錯誤欄位紅框標示
✓ 滾動至第一個錯誤

### 非功能需求
✓ 響應式設計 (NFR-RWD)
✓ 支援主流瀏覽器
✓ 手機優先設計
✓ 清晰的視覺層次

## 瀏覽器支援

- Chrome 90+
- Safari 14+
- Firefox 88+
- Edge 90+
- Samsung Internet 14+

## 開發環境

此為純前端靜態原型，無需額外安裝：
- 無後端依賴
- 無框架依賴（Vanilla JavaScript）
- 可直接用瀏覽器開啟

## 未來擴展

此原型可進一步整合：
1. 後端 API 串接
2. 金流商介接（綠界、藍新）
3. LINE Pay SDK 整合
4. 電子發票 API 串接
5. WebSocket 販賣機通訊
6. 完整的錯誤處理機制
7. 載入動畫與轉場效果

## 注意事項

⚠️ **這是原型 (Prototype)**
- 付款流程為模擬，無實際金流
- 發票號碼為隨機生成
- 未串接真實後端 API
- 僅作為前端介面展示使用

## 授權

本專案僅供內部開發測試使用

---

## 重要開發說明

### 給未來 AI 開發者的注意事項

1. **必讀文件**
   - 開始任何修改前，請先閱讀 `販賣機金流系統分析文件_SA_v2.txt`
   - 這份文件包含完整的系統規格、流程圖、測試案例
   - 所有更新記錄都在 `UPDATE_NOTES_*.md` 中

2. **設計原則**
   - 黑白色系為主，保持簡潔
   - 手機優先（Mobile First）設計
   - 所有頁面都有 Header（除了 LINE Pay 頁面）
   - 使用自訂 Modal，不使用系統 alert/confirm
   - 背景統一使用白色 (#fff)

3. **付款完成頁重要邏輯**
   - **成功時**: 不倒數、不跳轉、不彈窗
   - 原因：這是販賣機情境，用戶需要時間查看資訊、截圖、等待取貨
   - 直接顯示「✓ 交易完成，請從販賣機取貨後關閉此頁面」
   - **失敗時**: 提供重試和取消，都需要確認對話框

4. **測試卡號規則**
   - `4111 1111 1111 1111` → 成功
   - `4000 0000 0000 0002` → 失敗
   - 其他通過 Luhn 驗證的卡號 → 成功

5. **資料流程**
   - 使用 sessionStorage 在頁面間傳遞資料
   - key: `paymentData`
   - 付款成功後立即清除
   - 失敗時保留供重試

6. **圖片資源**
   - 信用卡圖示：`credit card logo.png`
   - LINE Pay Logo：`LINE-Pay(h)_W119_n.png`
   - 不要用 emoji，用實際圖片

7. **版本記錄**
   - 每次重要更新都要寫 UPDATE_NOTES
   - 編號遞增：UPDATE_NOTES_5.md, UPDATE_NOTES_6.md...
   - 記錄變更原因、前後對比、測試方式

---

**版本**: 2.0
**日期**: 2025/11/06
**基於**: 販賣機金流系統分析文件 v2.0
